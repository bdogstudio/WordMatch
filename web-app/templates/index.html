<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hot Take - Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 500px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        /* Setup Screen */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .screen.active {
            display: flex;
        }

        .title {
            text-align: center;
            color: white;
            margin-top: 60px;
            margin-bottom: auto;
        }

        .title h1 {
            font-size: 60px;
            font-weight: 900;
            line-height: 1.2;
            margin: 0;
        }

        .selection-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .selection-card label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .selection-card select {
            width: 100%;
            padding: 18px;
            font-size: 24px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            appearance: none;
        }

        .selection-card select option {
            background: #4ECDC4;
            color: white;
        }

        .btn {
            width: 100%;
            padding: 20px;
            font-size: 32px;
            font-weight: 900;
            border: none;
            border-radius: 35px;
            cursor: pointer;
            text-transform: uppercase;
            margin-bottom: 20px;
            transition: transform 0.1s, opacity 0.2s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: white;
            color: #FF6B6B;
        }

        .btn-yes {
            background: white;
            color: #4ECDC4;
        }

        .btn-no {
            background: white;
            color: #FF6B6B;
        }

        /* Game Screen */
        .game-header {
            display: flex;
            justify-content: space-between;
            color: white;
            margin-bottom: 20px;
        }

        .game-stat {
            text-align: left;
        }

        .game-stat:last-child {
            text-align: right;
        }

        .game-stat-label {
            font-size: 14px;
            font-weight: 700;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .game-stat-value {
            font-size: 20px;
            font-weight: 900;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.1s linear;
        }

        .question-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .question-prompt {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .adjective {
            font-size: 48px;
            font-weight: 900;
            background: rgba(255, 255, 255, 0.2);
            padding: 20px 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            text-transform: uppercase;
        }

        .item {
            font-size: 56px;
            font-weight: 900;
            line-height: 1.2;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .item.pulse {
            animation: pulse 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .button-row {
            display: flex;
            gap: 15px;
        }

        .btn-action {
            flex: 1;
            height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-icon {
            font-size: 40px;
            font-weight: 700;
        }

        /* Results Screen */
        .results-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
        }

        .results-title {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 40px;
        }

        .results-score {
            margin-bottom: 40px;
        }

        .score-big {
            font-size: 80px;
            font-weight: 900;
            line-height: 1;
        }

        .score-label {
            font-size: 24px;
            font-weight: 700;
            opacity: 0.8;
            margin-top: 10px;
        }

        .stats-box {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 40px;
            width: 100%;
            max-width: 300px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            margin-bottom: 12px;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            font-weight: 500;
            opacity: 0.9;
        }

        .stat-value {
            font-weight: 700;
        }

        /* Pause/Discussion Screen */
        .pause-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
        }

        .pause-title {
            font-size: 32px;
            font-weight: 700;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .pause-question {
            margin-bottom: 50px;
        }

        .pause-adjective {
            font-size: 40px;
            font-weight: 900;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .pause-item {
            font-size: 52px;
            font-weight: 900;
            line-height: 1.2;
        }

        .btn-continue {
            background: white;
            color: #FF6B6B;
            font-size: 28px;
        }

        @media (max-width: 400px) {
            .title h1 {
                font-size: 50px;
            }
            .adjective {
                font-size: 40px;
            }
            .item {
                font-size: 48px;
            }
            .pause-adjective {
                font-size: 36px;
            }
            .pause-item {
                font-size: 44px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Setup Screen -->
        <div class="screen active" id="setup-screen">
            <div class="title">
                <h1>HOT TAKE</h1>
            </div>

            <div style="margin-bottom: auto;">
                <div class="selection-card">
                    <label>Adjective</label>
                    <select id="adjective-select">
                        <option value="">Choose...</option>
                    </select>
                </div>

                <div class="selection-card">
                    <label>Category</label>
                    <select id="category-select">
                        <option value="">Choose...</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-primary" id="start-btn" disabled>Start</button>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="game-screen">
            <div class="game-header">
                <div class="game-stat">
                    <div class="game-stat-label">QUESTION <span id="current-question">1</span>/10</div>
                    <div class="game-stat-value">Score: <span id="score">0</span></div>
                </div>
                <div class="game-stat">
                    <div class="game-stat-label">TIME</div>
                    <div class="game-stat-value"><span id="timer">10</span>s</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>

            <div class="question-area">
                <div class="question-prompt">Is this...</div>
                <div class="adjective" id="adjective-display">FAST</div>
                <div class="item" id="item-display">Cheetah</div>
            </div>

            <div class="button-row">
                <button class="btn btn-action btn-no" id="no-btn">
                    <span class="btn-icon">✗</span>
                    <span>NO</span>
                </button>
                <button class="btn btn-action btn-yes" id="yes-btn">
                    <span class="btn-icon">✓</span>
                    <span>YES</span>
                </button>
            </div>
        </div>

        <!-- Pause/Discussion Screen -->
        <div class="screen" id="pause-screen">
            <div class="pause-content">
                <div class="pause-title">Discuss This!</div>

                <div class="pause-question">
                    <div class="pause-adjective" id="pause-adjective-display">FAST</div>
                    <div class="pause-item" id="pause-item-display">Cheetah</div>
                </div>
            </div>

            <button class="btn btn-continue" id="continue-btn">Continue</button>
        </div>

        <!-- Results Screen -->
        <div class="screen" id="results-screen">
            <div class="results-content">
                <div class="results-title">GAME OVER</div>

                <div class="results-score">
                    <div class="score-big" id="final-score">0</div>
                    <div class="score-label">POINTS</div>
                </div>

                <div class="stats-box">
                    <div class="stat-row">
                        <span class="stat-label">Questions</span>
                        <span class="stat-value" id="total-questions">10</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Accuracy</span>
                        <span class="stat-value" id="accuracy">0%</span>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="play-again-btn">
                <span>↻ Play Again</span>
            </button>
        </div>
    </div>

    <script>
        // Game State
        let adjectives = [];
        let categories = {};
        let selectedAdjective = null;
        let selectedCategory = null;
        let currentItems = [];
        let usedItems = new Set();
        let currentQuestion = 0;
        let score = 0;
        let timeRemaining = 10;
        let timerInterval = null;
        const MAX_QUESTIONS = 10;
        const TIME_LIMIT = 10;

        // Load data
        async function loadData() {
            const [adjectivesRes, categoriesRes] = await Promise.all([
                fetch('/api/adjectives'),
                fetch('/api/categories')
            ]);
            adjectives = await adjectivesRes.json();
            const categoryNames = await categoriesRes.json();

            // Populate selects
            const adjectiveSelect = document.getElementById('adjective-select');
            adjectives.forEach(adj => {
                const option = document.createElement('option');
                option.value = adj;
                option.textContent = adj;
                adjectiveSelect.appendChild(option);
            });

            const categorySelect = document.getElementById('category-select');
            categoryNames.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
        }

        // Setup Screen
        document.getElementById('adjective-select').addEventListener('change', checkSetupComplete);
        document.getElementById('category-select').addEventListener('change', checkSetupComplete);

        function checkSetupComplete() {
            const adjectiveSelect = document.getElementById('adjective-select');
            const categorySelect = document.getElementById('category-select');
            const startBtn = document.getElementById('start-btn');

            if (adjectiveSelect.value && categorySelect.value) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        }

        document.getElementById('start-btn').addEventListener('click', async () => {
            selectedAdjective = document.getElementById('adjective-select').value;
            selectedCategory = document.getElementById('category-select').value;

            // Load items for category
            const res = await fetch(`/api/items/${selectedCategory}`);
            currentItems = await res.json();

            startGame();
        });

        // Game Logic
        function startGame() {
            currentQuestion = 0;
            score = 0;
            usedItems.clear();

            showScreen('game-screen');
            nextQuestion();
        }

        function nextQuestion() {
            if (currentQuestion >= MAX_QUESTIONS) {
                endGame();
                return;
            }

            currentQuestion++;

            // Get random unused item
            let availableItems = currentItems.filter(item => !usedItems.has(item));
            if (availableItems.length === 0) {
                usedItems.clear();
                availableItems = currentItems;
            }

            const randomItem = availableItems[Math.floor(Math.random() * availableItems.length)];
            usedItems.add(randomItem);

            // Update UI
            document.getElementById('current-question').textContent = currentQuestion;
            document.getElementById('adjective-display').textContent = selectedAdjective.toUpperCase();
            document.getElementById('item-display').textContent = randomItem;
            document.getElementById('score').textContent = score;

            // Start timer
            timeRemaining = TIME_LIMIT;
            updateTimer();
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 100);

            // Enable buttons
            document.getElementById('yes-btn').disabled = false;
            document.getElementById('no-btn').disabled = false;
        }

        function updateTimer() {
            timeRemaining -= 0.1;

            if (timeRemaining <= 0) {
                timeRemaining = 0;
                handleTimeout();
            }

            document.getElementById('timer').textContent = Math.ceil(timeRemaining);
            const progress = (timeRemaining / TIME_LIMIT) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function handleAnswer(isYes) {
            clearInterval(timerInterval);

            // Disable buttons
            document.getElementById('yes-btn').disabled = true;
            document.getElementById('no-btn').disabled = true;

            // Add points (in real game, you'd validate the answer)
            score += 100;

            // Pulse animation
            const itemEl = document.getElementById('item-display');
            itemEl.classList.add('pulse');

            setTimeout(() => {
                itemEl.classList.remove('pulse');
                showPauseScreen();
            }, 500);
        }

        function handleTimeout() {
            clearInterval(timerInterval);

            // Disable buttons
            document.getElementById('yes-btn').disabled = true;
            document.getElementById('no-btn').disabled = true;

            setTimeout(showPauseScreen, 500);
        }

        function showPauseScreen() {
            // Update pause screen with current question
            document.getElementById('pause-adjective-display').textContent = selectedAdjective.toUpperCase();
            document.getElementById('pause-item-display').textContent = document.getElementById('item-display').textContent;

            showScreen('pause-screen');
        }

        document.getElementById('continue-btn').addEventListener('click', () => {
            nextQuestion();
        });

        document.getElementById('yes-btn').addEventListener('click', () => handleAnswer(true));
        document.getElementById('no-btn').addEventListener('click', () => handleAnswer(false));

        // Results Screen
        function endGame() {
            clearInterval(timerInterval);

            const accuracy = Math.round((score / (MAX_QUESTIONS * 100)) * 100);

            document.getElementById('final-score').textContent = score;
            document.getElementById('total-questions').textContent = MAX_QUESTIONS;
            document.getElementById('accuracy').textContent = accuracy + '%';

            showScreen('results-screen');
        }

        document.getElementById('play-again-btn').addEventListener('click', () => {
            showScreen('setup-screen');
        });

        // Helper Functions
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
